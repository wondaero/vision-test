<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <title>시력테스트</title>
        <link rel="stylesheet" href="assets/css/normalize.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />

        <style>
            header{
                box-sizing: border-box; padding: 10px; display: flex; align-items: center; justify-content: space-between;
                background: orange; margin-bottom: 10px;
            }
            h1{margin: 0; padding: 0;}
            header button{padding: 5px; border: 0; outline: 0; background: rgb(243, 204, 32); width: 80px;}

            .wrapper{padding: 0 10px;}

            .question > span{display: inline-block; font-size: 24px; transform-origin: 0 0;}

            .ex-list.hidden{display: none;}
            .ex-list li{margin-bottom: 5px; font-size: 20px; cursor: pointer;}
        </style>
        
     </head>
     <body>
        <header>
            <h1>시력테스트</h1>
            <div>
                <button onclick="visionTest.startGame();">시작</button>
                <!-- <button>랭킹</button> -->
            </div>
        </header>
        <div class="wrapper">
            <h2 id="level" class="level">시력 0</h2>
            <h2 id="guide" class="guide">시작버튼 클릭!</h2>
            <h3 id="question" class="question">
                <span></span>
            </h3>
            <ol id="exList" class="ex-list hidden">
                <li onclick="visionTest.guess(this)"></li>
                <li onclick="visionTest.guess(this)"></li>
                <li onclick="visionTest.guess(this)"></li>
                <li onclick="visionTest.guess(this)"></li>
                <li onclick="visionTest.guess(this)"></li>
            </ol>
        </div>

        <script>
            function getRandomNum(mn, mx){return Math.floor(Math.random() * (mx - mn + 1)) + mn;};

            const guide = document.querySelector('#guide');
            const lv = document.querySelector('#level');
            const question = document.querySelector('#question');
            const exList = document.querySelector('#exList');
            const exLi = exList.querySelectorAll('li');

            const txtArr = [
                {0: 'D', 1: 'O'},
                {0: 'S', 1: '$'},
                {0: '8', 1: '&'},
                {0: 'B', 1: '8'},
                {0: '8', 1: '3'},
                {0: 'i', 1: '!'},
                {0: 'g', 1: '9'},
                {0: '8', 1: 'g'},
                {0: 'Z', 1: '2'},
                {0: 'S', 1: '5'},
                {0: '4', 1: 'A'},
                {0: 'O', 1: 'Q'},
                {0: 'O', 1: '0'},
                {0: 'P', 1: 'R'},
                {0: 'l', 1: 'I'},
            ];


            const visionTest = new VisionTest();

            function VisionTest(){
                const t = this;

                t.init = function(){
                    t.startTime = 0;
                    t.endTime = 0;
                    t.qLevel = 0;
                    t.scale = 1.025;
                    t.q = '';
                    exList.classList.add('hidden');
                    guide.innerHTML = '시작버튼 클릭!';
                }
                
                t.init();

                t.startGame = function(){
                    t.init();
                    t.startTime = new Date().getTime();
                    exList.classList.remove('hidden');
                    guide.innerHTML = '아래 문자와 같은 것은?';
                    t.ing();
                }

                t.guess = function(target){
                    if(!t.startTime) return;
                    if(t.q === target.innerText){
                        if(t.qLevel == 1){
                            t.result(true);
                            return;
                        }
                        t.ing();
                    }else{
                        t.result();
                    }
                }

                t.ing = function(){
                    t.qLevel += 0.1;
                    t.qLevel = round(t.qLevel, 1);
                    lv.innerHTML = '시력 ' + t.qLevel;
                    t.scale -= 0.025;
                    t.scale = round(t.scale, 3);

                    question.querySelector('span').style.transform = 'scale(' + t.scale + ')';
                    
                    let finalTxt = '';
                    let txtIdxArr = [];
                    let selectIdxArr = [];
                    
                    for(let i = 0; i < 10; i++){
                        const rdmNum1 = getRandomNum(0, txtArr.length - 1);
                        const rdmNum2 = getRandomNum(0, 1);
                        
                        txtIdxArr.push(rdmNum1);
                        selectIdxArr.push(rdmNum2);
                        finalTxt += txtArr[rdmNum1][rdmNum2];
                    }

                    t.q = finalTxt;

                    question.querySelector('span').innerHTML = t.q;

                    
                    for(let i = 0; i < 5; i++){
                        let exFinalTxt = '';
                        
                        for(let j = 0; j < 10; j++){
                            exFinalTxt += txtArr[txtIdxArr[j]][getRandomNum(0, 1)];
                        }
                        
                        if(exFinalTxt == finalTxt){
                            const prevTxt = exFinalTxt.slice(0, exFinalTxt.length - 1);
                            const nextTxt = exFinalTxt.slice(-1) == txtArr[txtArr.length - 1][selectIdxArr[selectIdxArr.length - 1] == 0 ? 1 : 0];
                            exFinalTxt = prevTxt + nextTxt;
                        }

                        exLi[i].innerHTML = exFinalTxt;
                    }

                    t.setCorrectAnswer();

                }

                t.setCorrectAnswer = function(){
                    exLi[getRandomNum(0, 4)].innerHTML = t.q;
                }

                t.result = function(bool){
                    guide.innerHTML = '게임이 끝났습니다.';
                    exList.classList.add('hidden');
                }
            }

            const round = (num, digit) => Math.round(num * (10**digit)) / (10**digit);
        </script>
     </body>
</html>